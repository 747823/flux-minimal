"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Actions=function(){function Actions(actions){_classCallCheck(this,Actions);this.actions=actions;for(var key in actions){Object.defineProperty(this.actions,key,{writable:false,value:{subscribers:[],func:null}})}}_createClass(Actions,[{key:"registerAsync",value:function registerAsync(key,func){if(typeof key!=="string")throw new TypeError("Actions.registerAsync: key argument must be a string");if(typeof func!=="function")throw new TypeError("Actions.registerAsync: func argument must be a function");if(this.actions[key]===undefined)throw new Error("Actions.registerAsync: action not declared, please add it to the constructor");if(this.actions[key].func!==null)throw new Error("Actions.registerAsync: action already registered");Object.defineProperty(this.actions,key,{writable:false,value:{subscribers:[],func:func}})}},{key:"call",value:function call(key,args){var action=this.actions[key];if(action){if(typeof action.func==="function"){var done=this.buildDoneFunction(key);action.func(done,args)}else{this.publish(key)}}}},{key:"buildDoneFunction",value:function buildDoneFunction(key){var actions=this;return function(data){actions.publish(key,data)}}},{key:"publish",value:function publish(key,data){var action=this.actions[key];if(action){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=action.subscribers[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var each=_step.value;each(data)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}}},{key:"on",value:function on(key,callback){if(typeof key!=="string")throw new TypeError("Actions.on: key argument must be a string");if(typeof callback!=="function")throw new TypeError("Actions.on: callback argument must be a function");if(!this.actions[key].subscribers.includes(callback)){this.actions[key].subscribers.push(callback);return callback}}},{key:"unsubscribe",value:function unsubscribe(key,callback){var action=this.actions[key];if(action){for(var i=0;i<action.subscribers.length;i++){if(callback===action.subscribers[i]){action.subscribers.splice(i,1);return}}}}}]);return Actions}();function isObject(obj){return obj!==null&&obj instanceof Object&&Object.prototype.toString.call(obj)==="[object Object]"}var DataStore=function(){function DataStore(initState){_classCallCheck(this,DataStore);this.state=initState||{};this.subscribers=[]}_createClass(DataStore,[{key:"setState",value:function setState(newState){var stem=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.state;if(isObject(newState)===false){throw new TypeError("DataStore.setState: newState must be an object")}for(var key in newState){var item=newState[key];if(item===null||item===undefined){delete stem[key]}else if(isObject(item)&&isObject(stem[key])){this.setState(item,stem[key])}else{stem[key]=newState[key]}}if(stem===this.state){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.subscribers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var each=_step2.value;each(this.state)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return()}}finally{if(_didIteratorError2){throw _iteratorError2}}}}}},{key:"replaceState",value:function replaceState(newState){if((typeof newState==="undefined"?"undefined":_typeof(newState))!=="object"||newState===null)return;this.state=newState;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.subscribers[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var each=_step3.value;each(this.state)}}catch(err){_didIteratorError3=true;_iteratorError3=err}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return()}}finally{if(_didIteratorError3){throw _iteratorError3}}}}},{key:"onStateChanged",value:function onStateChanged(callback){if(typeof callback==="function"&&!this.subscribers.includes(callback)){this.subscribers.push(callback);return callback}}},{key:"unsubscribe",value:function unsubscribe(callback){for(var i=0;i<this.subscribers.length;i++){if(callback===this.subscribers[i]){this.subscribers.splice(i,1);return}}}}]);return DataStore}();module.exports={Actions:Actions,DataStore:DataStore};